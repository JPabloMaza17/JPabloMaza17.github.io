<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora xG - xGOT: Fútbol</title>
  <style>
    body {
      text-align: center;
      font-family: Arial, sans-serif;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .field {
      width: 525px;
      height: 340px;
      background-image: url('https://i.imgur.com/Cwnw52i.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      cursor: crosshair;
      border: 1px solid #000;
      position: relative;
    }
    /* Portería realzada */
    .goal {
      width: 732px;
      height: 244px;
      position: relative;
      cursor: crosshair;
      border: 3px solid black;
      background-color: #fff;
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 15px, rgba(0,0,0,0.1) 15px, rgba(0,0,0,0.1) 16px),
        repeating-linear-gradient(90deg, transparent, transparent 15px, rgba(0,0,0,0.1) 15px, rgba(0,0,0,0.1) 16px);
      background-size: 100% 16px, 16px 100%;
    }
    .goal .post {
      position: absolute;
      background-color: black;
      width: 10px;
    }
    .goal .post.left {
      left: 0;
      top: 0;
      height: 100%;
    }
    .goal .post.right {
      right: 0;
      top: 0;
      height: 100%;
    }
    .goal .crossbar {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 10px;
      background-color: black;
    }
    .coordinates {
      font-size: 18px;
      background: rgba(255, 255, 255, 0.7);
      padding: 5px;
      border-radius: 5px;
      display: block;
      width: fit-content;
      margin: 10px auto;
    }
    .log {
      width: 60%;
      text-align: left;
      border: 1px solid #000;
      padding: 10px;
      background-color: #f9f9f9;
      max-height: 200px;
      overflow-y: auto;
    }
    /* Estilos base para los marcadores */
    .marker {
      position: absolute;
      transform: translate(-50%, -50%);
      z-index: 1000;
    }
    /* Marcador para el balón (rojo) en ambos contextos */
    .marker.ball {
      width: 8px;
      height: 8px;
      background-color: red;
      border-radius: 50%;
    }
    /* Marcador para el portero en la portería (imagen de guante) */
    .marker.keeper {
      width: 24px;
      height: 24px;
      background-image: url('https://upload.wikimedia.org/wikipedia/commons/9/9c/Football_gloves_icon.svg');
      background-size: contain;
      background-repeat: no-repeat;
    }
  </style>
</head>
<body>
  <h2>Calculadora xG - xGOT: Fútbol</h2>
  <div class="container">
    <div class="field" id="footballField"></div>
    <div class="coordinates" id="coordinatesXG">X: -, Y: -, xG: -</div>
    <div class="goal" id="goalArea">
      <div class="post left"></div>
      <div class="post right"></div>
      <div class="crossbar"></div>
    </div>
    <div class="coordinates" id="coordinatesXGOT">Balón: Y: -, Z: - | Portero: Y: -, Z: - | xGOT: -</div>
  </div>
  <h3>Registros:</h3>
  <div class="log" id="logContainer"></div>
  <script>
    let ballPosition = null;
    let keeperPosition = null;
    const goalWidth = 7.32;
    const goalHeight = 2.44;
    const scaleY = 732 / goalWidth;
    const scaleZ = 244 / goalHeight;
    
    function createMarker(x, y, parent, type) {
      const marker = document.createElement("div");
      marker.classList.add("marker", type);
      marker.style.left = `${x}px`;
      marker.style.top = `${y}px`;
      parent.appendChild(marker);
    }
    
    // Evento para el campo (xG) – usa el marcador rojo normal
    document.getElementById("footballField").addEventListener("click", function(event) {
      const field = event.currentTarget.getBoundingClientRect();
      const xPixel = event.clientX - field.left;
      const yPixel = event.clientY - field.top;
      
      const xMeters = (xPixel / 5).toFixed(1);
      const yMeters = ((340 - yPixel) / 5).toFixed(1);
      
      // Centro de la portería para cálculo de xG
      const xGoal = 105;
      const yCenter = 34;
      
      const distance = Math.sqrt(Math.pow((xGoal - xMeters), 2) + Math.pow((yCenter - yMeters), 2));
      const xG = (76462 / (1 + Math.exp(0.159 * (distance + 69.56)))).toFixed(2);
      
      document.getElementById("coordinatesXG").innerHTML = `X: ${xMeters}, Y: ${yMeters}, xG: ${xG}`;
      logEvent(`xG registrado - X: ${xMeters}, Y: ${yMeters}, xG: ${xG}`);
      
      createMarker(xPixel, yPixel, event.currentTarget, "ball");
    });
    
    // Evento para la portería (xGOT)
    document.getElementById("goalArea").addEventListener("click", function(event) {
      const goal = event.currentTarget.getBoundingClientRect();
      const yPixel = event.clientX - goal.left;
      const zPixel = event.clientY - goal.top;
      
      const yMeters = Math.max(0, Math.min(goalWidth, (yPixel / scaleY).toFixed(2)));
      const zMeters = Math.max(0, Math.min(goalHeight, ((244 - zPixel) / scaleZ).toFixed(2)));
      
      if (!ballPosition) {
        ballPosition = { y: yMeters, z: zMeters };
        document.getElementById("coordinatesXGOT").innerHTML = 
          `Balón: Y: ${ballPosition.y}, Z: ${ballPosition.z} | Portero: Y: -, Z: - | xGOT: -`;
        // Primer marcador en portería: marcador del balón (rojo normal)
        createMarker(yPixel, zPixel, event.currentTarget, "ball");
      } else if (!keeperPosition) {
        keeperPosition = { y: yMeters, z: zMeters };
        const distance = Math.sqrt(
          Math.pow(ballPosition.y - keeperPosition.y, 2) + 
          Math.pow(ballPosition.z - keeperPosition.z, 2)
        );
        const xGOT = (0.128 * distance).toFixed(2);
        document.getElementById("coordinatesXGOT").innerHTML = 
          `Balón: Y: ${ballPosition.y}, Z: ${ballPosition.z} | Portero: Y: ${keeperPosition.y}, Z: ${keeperPosition.z} | xGOT: ${xGOT}`;
        logEvent(`xGOT registrado - Balón: Y: ${ballPosition.y}, Z: ${ballPosition.z} | Portero: Y: ${keeperPosition.y}, Z: ${keeperPosition.z} | xGOT: ${xGOT}`);
        // Segundo marcador en portería: marcador del portero con imagen de guante
        createMarker(yPixel, zPixel, event.currentTarget, "keeper");
        ballPosition = null;
        keeperPosition = null;
      }
    });
    
    function logEvent(message) {
      const logContainer = document.getElementById("logContainer");
      const logEntry = document.createElement("div");
      logEntry.textContent = message;
      logContainer.appendChild(logEntry);
    }
  </script>
</body>
</html>
